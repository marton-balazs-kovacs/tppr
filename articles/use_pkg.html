<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the package â€¢ tppr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the package">
<meta property="og:description" content="tppr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tppr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/use_app.html">use_app</a>
    </li>
    <li>
      <a href="../articles/use_pkg.html">Using the package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/marton-balazs-kovacs/tppr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="use_pkg_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the package</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/marton-balazs-kovacs/tppr/blob/master/vignettes/use_pkg.Rmd"><code>vignettes/use_pkg.Rmd</code></a></small>
      <div class="hidden name"><code>use_pkg.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>First, you have to install the package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># install.packages("devtools")</span>
<span class="kw">devtools</span>::<span class="fu">install_github</span>(<span class="st">"marton-balazs-kovacs/tppr"</span>)
</pre></div>
<p>Second you have to load the package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/marton-balazs-kovacs/tppr">tppr</a></span>)
</pre></div>
</div>
<div id="setting-the-analysis-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#setting-the-analysis-parameters" class="anchor"></a>Setting the analysis parameters</h1>
<p>The analysis depends on preset parameters that are saved as a list of values in the analysis_params datafile. This datafile is part of the package. If you want to know more about the default analysis parameters check <code><a href="../reference/analysis_params.html">?tppr::analysis_params</a></code>.</p>
<p>You can load the analysis parameters datafile in the current workspace.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># data(analysis_params)</span>
</pre></div>
<p>You can also modify the parameters after loading.</p>
<p>Getting the probability of M0:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># analysis_params$m0_prob</span>
</pre></div>
<p>Changing the value:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># analysis_params$m0_prob &lt;- 0.53</span>
</pre></div>
</div>
<div id="import-data" class="section level1">
<h1 class="hasAnchor">
<a href="#import-data" class="anchor"></a>Import data</h1>
<p>You can run the analysis on several different data types:</p>
<ul>
<li>Example dataset where M0 is simulated to be true</li>
<li>Example dataset where M1 is simulated to be true</li>
<li>Example data generated by yourself</li>
<li>The collected pilot dataset</li>
<li>The collected test dataset</li>
<li>The collected live dataset</li>
</ul>
<p>In the following we show you how to load each type of data.</p>
<div id="example-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#example-datasets" class="anchor"></a>Example datasets</h2>
<p>The example datasets are included in the package. If you want to know more about the datasets you can use the <code>?tppr::exampl_m0</code> and the <code>?tppr::exampl_m1</code> functions to read the documentation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co"># To load the dataset where M0 is simulated to be true</span>
<span class="co"># data(example_m0)</span>

<span class="co"># To load the dataset where M1 is simulated to be true</span>
<span class="co"># data(example_m1)</span>
</pre></div>
</div>
<div id="generate-example-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-example-dataset" class="anchor"></a>Generate example dataset</h2>
<p>It is also possible to generate your own example dataset.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># my_tppr_data &lt;- generate_example_data()</span>
</pre></div>
</div>
<div id="collected-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#collected-datasets" class="anchor"></a>Collected datasets</h2>
<p>You can download and read the collected data from the projects Github repository. There are three types of collected data:</p>
<ul>
<li>test: The data are collected by testing the data collection program.</li>
<li>pilot: The data are collected during the pilot study.</li>
<li>live: The data are collected during live testing. These data will go in the analysis and the results will be presented in the paper.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># Read live data</span>
<span class="kw">tpp_raw_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_data.html">read_data</a></span>(type = <span class="st">"live"</span>)
<span class="co">#&gt; There are 586 participants who started the experiment.</span>

<span class="co"># For testing purposes we will use the example_m0 dataset from now on</span>
<span class="kw">tpp_raw_data</span> <span class="op">&lt;-</span> <span class="kw">tppr</span>::<span class="kw"><a href="../reference/example_m0.html">example_m0</a></span>
</pre></div>
</div>
</div>
<div id="cleaning-the-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#cleaning-the-dataset" class="anchor"></a>Cleaning the dataset</h1>
<p>After reading the raw data that contains all the trials during data cleaning the empty trials are excluded and only the erotic trials are kept.</p>
<p>However, this step is included in the primary confirmatory analysis function <code>analysis_confirmatory</code>, therefore you do not have to run it separately.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">tpp_processed_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_data.html">clean_data</a></span>(raw_data = <span class="kw">tpp_raw_data</span>)
</pre></div>
</div>
<div id="calculate-study-descriptives" class="section level1">
<h1 class="hasAnchor">
<a href="#calculate-study-descriptives" class="anchor"></a>Calculate study descriptives</h1>
<p>All the descriptive results of the study can be calculated with the <code><a href="../reference/sample_descriptives.html">?tppr::sample_descriptives</a></code> function. The function returns a list of the descriptive results that can be later used to populate the research paper.</p>
<p>The function runs at the latest passed checkpoint, unless it is indicated differently in the which_checkpoint argument.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># descriptive_results &lt;- sample_descriptives(raw_data = tpp_raw_data, which_checkpoint = NA_integer_)</span>
</pre></div>
</div>
<div id="checking-the-current-and-the-next-checkpoint" class="section level1">
<h1 class="hasAnchor">
<a href="#checking-the-current-and-the-next-checkpoint" class="anchor"></a>Checking the current and the next checkpoint</h1>
<p>To get information about the currently passed checking point based on the number of trials (either all trials or only the erotic trials) the <code><a href="../reference/tell_checkpoint.html">?tppr::tell_checkpoint</a></code> function can be be used.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">checkpoint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tell_checkpoint.html">tell_checkpoint</a></span>(df = <span class="kw">tpp_processed_data</span>)
</pre></div>
<p>The number of valid erotic trials:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">checkpoint</span><span class="op">$</span><span class="kw">total_n</span>
<span class="co">#&gt; [1] 51457</span>
</pre></div>
<p>The closest checkpoint that is passed:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">checkpoint</span><span class="op">$</span><span class="kw">current_checkpoint</span>
<span class="co">#&gt; [1] 1</span>
</pre></div>
<p>Next closest checkpoint:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">checkpoint</span><span class="op">$</span><span class="kw">next_checkpoint</span>
<span class="co">#&gt; [1] 2</span>
</pre></div>
<p>Row number of the last row at the current checkpoint:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">checkpoint</span><span class="op">$</span><span class="kw">last_row</span>
<span class="co">#&gt; [1] 86592</span>
</pre></div>
</div>
<div id="run-the-primary-confirmatory-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#run-the-primary-confirmatory-analysis" class="anchor"></a>Run the primary confirmatory analysis</h1>
<div id="the-structure-of-the-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#the-structure-of-the-analysis" class="anchor"></a>The structure of the analysis</h2>
<p>First, the primary confirmatory analysis splits the data at each passed checking point and saves the results into a list of dataframes. This step can be done separately with the <code><a href="../reference/split_data.html">tppr::split_data</a></code> function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="co"># tpp_split_data &lt;- split_data(processed_data = tpp_processed_data)</span>
</pre></div>
<p>Second, the code iterates trough the splitted dataframes and calculates the mixed-effects logistic regression and Bayes factors with three different priors.</p>
<p>These calculations can be run separately. * Mixed-effects logistic regression: <code><a href="../reference/confirmatory_mixed_effect.html">?tppr::confirmatory_mixed_effect</a></code> * Bayes factor with three different priors: <code>?tppr:confirmatory_bayes_factor</code></p>
<p>Third, based on the results of the 4 primary analysis the function makes an inference at each stopping point. * M1: If all the four analysis supports the M1 model * M0: If all the four analysis supports the M0 model * Ongoing: If the four analysis do not support the same model and the last checking point is not reached * Inconclusive: If the four analysis do not support the same model and the last checking point is reached</p>
<p>The primary analysis function will run all these subfunctions and return the result as a dataframe.</p>
<p>To run the primary analysis function run the following code on the processed data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="co"># confirmatory_results &lt;- analysis_confirmatory(raw_data = tpp_raw_data)</span>
</pre></div>
</div>
<div id="calculate-the-cumulative-bayes-factor" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-the-cumulative-bayes-factor" class="anchor"></a>Calculate the cumulative Bayes factor</h2>
<p>For the primary analysis plot we have to calculate the cumulative Bayes factors with the three priors for every trial.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">cumulative_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cumulative_bayes_factor.html">cumulative_bayes_factor</a></span>(df = <span class="kw">tpp_raw_data</span>)
</pre></div>
</div>
<div id="visualise-the-result" class="section level2">
<h2 class="hasAnchor">
<a href="#visualise-the-result" class="anchor"></a>Visualise the result</h2>
<p>To visualize the results of the primary confirmatory analysis the <code>?tppr::plot_confrimatory</code> can be used.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="co"># plot_confirmatory(cumulative_results = cumulative_results)</span>
</pre></div>
</div>
</div>
<div id="run-the-robustness-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#run-the-robustness-analysis" class="anchor"></a>Run the robustness analysis</h1>
<p>If the primary confirmatory analysis did not reach a conclusion (either support for M0 or for M1), the robustness analysis inference will be NA.</p>
<p>In our example case the analysis supports M0 at the first checkpoint. If multiple checkpoints were reached we could run the robustness analysis for multiple checkpoints, or we could extract the results of the confirmatory analysis for the last checkpoint with the following code.</p>
<p>By default, the <code>analysis_robustness</code> and the <code>analysis_exploratory</code> functions extract the last row of th primary confirmatory analysis results output.</p>
<p>We could run the robustness analysis with the following code on the last row of the primary analysis results:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="co"># robustness_results &lt;- analysis_robustness(confirmatory_results = confirmatory_results)</span>
</pre></div>
<div id="visualise-the-result-1" class="section level2">
<h2 class="hasAnchor">
<a href="#visualise-the-result-1" class="anchor"></a>Visualise the result</h2>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="co"># plot_robustness(posterior_density, hdi_mode, hdi_l, hdi_u, mixed_ci_width, mixed_ci_l, mixed_ci_u)</span>
</pre></div>
</div>
</div>
<div id="run-the-exploratory-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#run-the-exploratory-analysis" class="anchor"></a>Run the exploratory analysis</h1>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="co"># exploratory_results &lt;- analysis_exploratory(df = tpp_raw_data)</span>
</pre></div>
<div id="visualize-the-results" class="section level2">
<h2 class="hasAnchor">
<a href="#visualize-the-results" class="anchor"></a>Visualize the results</h2>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="co"># plot_exploratory(success_rates_theoretical_prop, success_rates_empirical_prop, possible_success_rates)</span>
</pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Marton Kovacs, Zoltan Kekecs.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
